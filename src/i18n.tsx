import React, { createContext, useContext, useMemo, useState } from 'react'

export type Lang = 'VN' | 'JP'

type Dict = Record<string, string>

const DICTS: Record<Lang, Dict> = {
  VN: {
    brand: 'MILK CHAIN',
    choose_entry: 'Chọn cổng truy cập',
    language: 'Ngôn ngữ',
    entry_user: 'Người chơi',
    entry_farm: 'Trang trại',

    // Farm nav
    nav_dashboard: 'Dashboard',
    nav_reports: 'Báo cáo',
    nav_cows: 'Đàn bò',
    nav_tasks: 'Nhiệm vụ',
    nav_inventory: 'Tồn kho',
    nav_orders: 'Đơn hàng',
    nav_settings: 'Cài đặt',
    nav_notifications: 'Thông báo',
    dash_internal: 'Tình hình Nội tại',
    total_cows: 'Tổng số bò',
    top_health: 'Tình trạng chiếm đa số',
    count: 'Số lượng',
    today_milk: 'Sản lượng sữa hôm nay',
    vs_yesterday: 'so với hôm qua',
    inventory: 'Tồn kho',
    available: 'Sẵn có',
    low: 'Sắp hết',
    out_of_stock: 'Hết hàng',
    total_value: 'Tổng giá trị',
    supply_demand_7d: 'Phân tích Cung-Cầu Thị trường (7 ngày tới)',
    forecast_supply: 'Dự báo Cung',
    forecast_demand: 'Dự báo Cầu',
    analysis_recommendations: 'Gợi ý từ Hệ thống Phân tích',
    view: 'Xem',
    rec_type_alert: 'Cảnh báo',
    rec_type_opportunity: 'Cơ hội',
    rec_type_action: 'Hành động',
    alerts_and_tasks: 'Cảnh báo & Nhiệm vụ Ưu tiên',
    smart_alerts: 'Cảnh báo Thông minh',
    alert: 'Cảnh báo',
    priority_tasks_today: 'Nhiệm vụ Ưu tiên Hôm nay',
    add_task: 'Thêm nhiệm vụ',
    name: 'Tên',
    assignee: 'Người phụ trách',
    type: 'Loại',
    due: 'Hạn',
    status: 'Trạng thái',
    task_type_strategic: 'Nhiệm vụ Chiến lược',
    task_type_routine: 'Nhiệm vụ định kỳ',
    completed: 'Hoàn thành',
    in_progress: 'Đang thực hiện',
    filters: 'Bộ lọc',
    search_by_id: 'Tìm theo mã',
    all_health: 'Tất cả tình trạng',
    all_breeds: 'Tất cả giống',
    dob: 'Ngày sinh',
    pred_24h: 'Dự kiến 24h tới',
    potential_7d: 'Tiềm năng 7 ngày',
    factors: 'Yếu tố',
    add_log: 'Ghi nhật ký',
    delete: 'Xóa',
    farm_report_milk_14d: 'Báo cáo sản lượng sữa (14 ngày)',
    farm_report_supply_demand: 'Báo cáo Tối ưu hóa Cung - Cầu',
    actual_production: 'Sản lượng Thực tế',
    allocated_demand: 'Nhu cầu phân bổ',
    farm_report_gap_hint: 'Khoảng cách giữa các đường biểu thị chi phí cơ hội hoặc lãng phí.',
    farm_report_employee_performance: 'Hiệu quả công việc của nhân viên (số nhiệm vụ hoàn thành)',
    tasks: 'Nhiệm vụ',
    inv_total_value: 'Tổng giá trị tồn kho',
    priority_alerts: 'Cảnh báo Ưu tiên',
    inv_low_hint: 'chỉ còn đủ dùng trong 3 ngày!',
    all_items: 'Tất cả Vật tư',
    category: 'Danh mục',
    stock: 'Tồn kho',
    unit: 'Đơn vị',
    actions: 'Hành động',
    view_detail: 'Xem chi tiết',
    import_stock: 'Nhập kho',
    export_adjust: 'Xuất/Điều chỉnh',
    orders_list: 'Danh sách đơn hàng',
    create_order: 'Tạo đơn hàng',
    customer: 'Khách hàng',
    products: 'Sản phẩm',
    delivery_date: 'Giao ngày',

    // Auth
    login: 'Đăng nhập',
    signup: 'Đăng ký',
    continue_with: 'Tiếp tục với',
    or_create_with_email: 'hoặc tạo bằng email',
    email: 'Email',
    password: 'Mật khẩu',

    // Adopt
    welcome_user: 'Chào mừng, User',
    adopt_title: "Let's adopt a cow",
    available_cows: 'Danh sách bò khả dụng',
    see_all: 'Xem tất cả',
    select: 'Chọn',
    adopt: 'Nhận nuôi',

    // Home
    hello_owner: "Xin chào, Chủ của Cow001",
    daily_task: 'Nhiệm vụ ngày',
    rank: 'Xếp hạng',
    cows_status: 'Tình trạng của Bò',
    health_overall: 'Sức khỏe tổng quát',
    milk_yield: 'Năng suất sữa',
    feeding: 'Khẩu phần ăn',
    latest_activity: 'Hoạt động gần nhất',
    home: 'Trang chủ',
    cow_profile: 'Hồ sơ Bò',
    scan_qr: 'Quét QR',
    report: 'Báo cáo',
    notification: 'Thông báo',

    // Cow profile
    identity: 'Thông tin định danh',
    origin: 'Nguồn gốc',
    health_rt: 'Sức khỏe (real-time)',
    temperature: 'Nhiệt độ',
    heart_rate: 'Nhịp tim',
    sign: 'Dấu hiệu',
    overall: 'Tổng quát',
    milk: 'Năng suất sữa',
    feeding_rt: 'Cho ăn (real-time)',
    meals_today: 'Số lần ăn hôm nay',
    consumption: 'Lượng tiêu thụ',
    last_activity: 'Hoạt động gần nhất',
    vaccine_history: 'Tiền sử tiêm phòng',

    // Scan QR
    scan_qr_title: 'Quét QR',
    scan_mock_hint: 'Mô phỏng: nhập mã QR bất kỳ để nhận thưởng',
    paste_qr: 'Dán mã QR...',
    scan: 'Quét',
    avg_temp: 'Nhiệt độ TB',
    avg_hr: 'Nhịp tim TB',
    activity: 'Hoạt động',
    alerts: 'Cảnh báo',

    // Notifications text
    notif_health_alert: 'Cảnh báo sức khỏe',
    notif_temp_up: 'Nhiệt độ tăng nhẹ trong {hours}h',
    notif_feeding_done: 'Đã ăn xong',
    notif_feeding_full: 'Bò đã hoàn thành {percent}% khẩu phần',
    notif_reward: 'Nhận thưởng',
    notif_reward_points: 'Bạn nhận {points} điểm từ nhiệm vụ',

    // Reports
    health_report: 'Báo cáo sức khỏe (mô phỏng)',
    productivity_14d: 'Báo cáo năng suất (14 ngày)',

    // Daily tasks
    daily_tasks: 'Nhiệm vụ hằng ngày',
    done: 'Hoàn thành',
    mark_done: 'Đánh dấu xong',

    // Rank
    farm_rank: 'Xếp hạng trang trại',

    // User profile
    personal_info: 'Thông tin cá nhân',
    foster_cow: 'Bò đang nhận nuôi',
    game_account: 'Tài khoản game',
    change_language: 'Đổi ngôn ngữ',
    logout: 'Đăng xuất',

    // Farm data keys
    feed_a: 'Thức ăn loại A',
    antibiotic_x: 'Kháng sinh X',
    barn_cleaner: 'Dung dịch vệ sinh chuồng',
    milk_bottle_1l: 'Sữa tươi 1L',

    farm_alert_cow_drop: 'Bò giảm sản lượng',
    farm_alert_cow_drop_desc: 'Ảnh hưởng -{impact} lít vào dự báo cung tuần này.',
    farm_alert_feed_low: 'Thức ăn sắp hết',
    farm_alert_feed_low_desc: 'Thiếu hụt sẽ làm giảm tổng sản lượng nếu không nhập kịp.',

    rec_surplus: 'Dự báo dư thừa ~1,200 lít trong 5 ngày tới do nhà máy ABC giảm đơn hàng.',
    rec_contact_factory: 'Liên hệ Nhà máy chế biến XYZ (cách 30km), họ đang có nhu cầu sữa bột.',
    rec_reduce_feed: 'Cân nhắc giảm khẩu phần ăn tăng cường cho đàn bò #3 trong 3 ngày tới.',
    rec_demand_up: 'Nhu cầu thị trường dự báo tăng mạnh (+15%) vào cuối tuần do thời tiết nắng nóng.',
    rec_increase_feed: 'Ưu tiên áp dụng khẩu phần ăn tăng sản lượng cho 25 con bò tiềm năng cao nhất.',

    alert_cow_drop: 'Bò giảm sản lượng 20%',
    alert_cow_drop_impact: '-{impact} lít vào dự báo cung tuần này',
    alert_feed_low: 'Thức ăn loại A sắp hết',
    alert_feed_low_impact: 'Có thể giảm 5% tổng sản lượng nếu không nhập kịp',
  },
  JP: {
    brand: 'MILK CHAIN',
    choose_entry: '入口を選択',
    language: '言語',
    entry_user: 'ユーザー',
    entry_farm: 'ファーム',

    nav_dashboard: 'ダッシュボード',
    nav_reports: 'レポート',
    nav_cows: '牛群',
    nav_tasks: 'タスク',
    nav_inventory: '在庫',
    nav_orders: '注文',
    nav_settings: '設定',
    nav_notifications: '通知',
    dash_internal: '内部状況',
    total_cows: '総頭数',
    top_health: '最多の健康状態',
    count: '数量',
    today_milk: '本日の搾乳量',
    vs_yesterday: '前日比',
    inventory: '在庫',
    available: '在庫あり',
    low: '少ない',
    out_of_stock: '在庫切れ',
    total_value: '総額',
    supply_demand_7d: '需給分析（7日）',
    forecast_supply: '供給予測',
    forecast_demand: '需要予測',
    analysis_recommendations: '分析からの提案',
    view: '表示',
    rec_type_alert: '警告',
    rec_type_opportunity: '機会',
    rec_type_action: 'アクション',
    alerts_and_tasks: '警告と優先タスク',
    smart_alerts: 'スマート警告',
    alert: '警告',
    priority_tasks_today: '本日の優先タスク',
    add_task: 'タスク追加',
    name: '名称',
    assignee: '担当者',
    type: '種別',
    due: '期限',
    status: '状態',
    task_type_strategic: '戦略タスク',
    task_type_routine: '定例タスク',
    completed: '完了',
    in_progress: '進行中',
    filters: 'フィルター',
    search_by_id: 'IDで検索',
    all_health: '全ての健康状態',
    all_breeds: '全ての品種',
    dob: '生年月日',
    pred_24h: '24時間予測',
    potential_7d: '7日間潜在',
    factors: '要因',
    add_log: '日誌を追加',
    delete: '削除',
    farm_report_milk_14d: '搾乳量レポート（14日）',
    farm_report_supply_demand: '需給最適化レポート',
    actual_production: '実績生産量',
    allocated_demand: '割当需要',
    farm_report_gap_hint: '線間の距離は機会損失または無駄を示します。',
    farm_report_employee_performance: '従業員の業務効率（完了タスク数）',
    tasks: 'タスク',
    inv_total_value: '在庫総額',
    priority_alerts: '優先アラート',
    inv_low_hint: 'は残り3日分しかありません！',
    all_items: '全ての資材',
    category: 'カテゴリ',
    stock: '在庫',
    unit: '単位',
    actions: '操作',
    view_detail: '詳細',
    import_stock: '入庫',
    export_adjust: '出庫/調整',
    orders_list: '注文一覧',
    create_order: '注文作成',
    customer: '顧客',
    products: '商品',
    delivery_date: '納期',

    login: 'ログイン',
    signup: 'サインアップ',
    continue_with: 'で続行',
    or_create_with_email: 'またはメールで作成',
    email: 'メール',
    password: 'パスワード',

    welcome_user: 'ようこそ, User',
    adopt_title: '牛を里親に迎えましょう',
    available_cows: '利用可能な牛',
    see_all: 'すべて表示',
    select: '選択',
    adopt: '里親になる',

    hello_owner: 'こんにちは、Cow001 のオーナー',
    daily_task: 'デイリータスク',
    rank: 'ランキング',
    cows_status: '牛のステータス',
    health_overall: '総合健康',
    milk_yield: '搾乳量',
    feeding: '給餌',
    latest_activity: '最新アクティビティ',
    home: 'ホーム',
    cow_profile: '牛のプロフィール',
    scan_qr: 'QRスキャン',
    report: 'レポート',
    notification: '通知',

    identity: '識別情報',
    origin: '由来',
    health_rt: '健康（リアルタイム）',
    temperature: '体温',
    heart_rate: '心拍数',
    sign: '兆候',
    overall: '総合',
    milk: '搾乳',
    feeding_rt: '給餌（リアルタイム）',
    meals_today: '本日の給餌回数',
    consumption: '消費率',
    last_activity: '直近の活動',
    vaccine_history: '予防接種履歴',

    scan_qr_title: 'QRスキャン',
    scan_mock_hint: 'シミュレーション：任意のコードで報酬',
    paste_qr: 'QRコードを貼り付け...',
    scan: 'スキャン',
    avg_temp: '平均体温',
    avg_hr: '平均心拍',
    activity: '活動',
    alerts: '警告',

    notif_health_alert: '健康アラート',
    notif_temp_up: '{hours}時間で体温がわずかに上昇',
    notif_feeding_done: '給餌完了',
    notif_feeding_full: '牛は{percent}%の給餌を完了',
    notif_reward: '報酬',
    notif_reward_points: 'タスクから{points}ポイントを獲得',

    health_report: '健康レポート（モック）',
    productivity_14d: '生産性レポート（14日）',

    daily_tasks: 'デイリータスク',
    done: '完了',
    mark_done: '完了にする',

    farm_rank: 'ファームランキング',

    personal_info: '個人情報',
    foster_cow: '里親中の牛',
    game_account: 'ゲームアカウント',
    change_language: '言語を変更',
    logout: 'ログアウト',

    feed_a: '飼料A',
    antibiotic_x: '抗生物質X',
    barn_cleaner: '牛舎洗浄液',
    milk_bottle_1l: '牛乳1L',

    farm_alert_cow_drop: '搾乳量の低下',
    farm_alert_cow_drop_desc: '今週の供給予測に-{impact}Lの影響',
    farm_alert_feed_low: '飼料が不足',
    farm_alert_feed_low_desc: '補充が遅れると総生産量が低下します。',

    rec_surplus: 'ABC工場の注文減少により、5日以内に約1,200Lの余剰が予測されます。',
    rec_contact_factory: '加工工場XYZ（30km）に連絡。粉乳需要あり。',
    rec_reduce_feed: '3日間、群#3の強化飼料を減らすことを検討。',
    rec_demand_up: '週末は猛暑により市場需要+15%の見込み。',
    rec_increase_feed: '生産性の高い上位25頭に増産飼料を優先適用。',

    alert_cow_drop: '牛の搾乳量が20%低下',
    alert_cow_drop_impact: '今週の供給予測に-{impact}Lの影響',
    alert_feed_low: '飼料Aが不足',
    alert_feed_low_impact: '補充が遅れると総生産量が5%低下の恐れ',
  },
}

type I18nContextType = {
  lang: Lang
  setLang: (l: Lang) => void
  t: (key: string) => string
}

const I18nContext = createContext<I18nContextType | null>(null)

export function I18nProvider({ children }: { children: React.ReactNode }){
  const [lang, setLang] = useState<Lang>(() => (localStorage.getItem('lang') as Lang) || 'VN')
  const value = useMemo<I18nContextType>(() => ({
    lang,
    setLang: (l: Lang) => { localStorage.setItem('lang', l); setLang(l) },
    t: (key: string) => DICTS[lang][key] ?? key,
  }), [lang])
  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>
}

export function useI18n(){
  const ctx = useContext(I18nContext)
  if(!ctx) throw new Error('useI18n must be used within I18nProvider')
  return ctx
}


